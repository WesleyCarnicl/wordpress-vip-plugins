{"version":3,"sources":["stackcommerce-wp.js"],"names":["jQuery","document","ready","querySelector","sc_connect","StackCommerce_WP","updateForm","select2","tags","tokenSeparators","minimumInputLength","containerCssClass","dropdownCssClass","addEventListener","notify","bind","keypress","performKeycheck","change","_classCallCheck","this","$endpoint","getValue","$form","$submit_button","_this","$account_id","$secret_key","setConnectionStatus","ajax","method","url","processData","contentType","dataType","data","JSON","stringify","generatePayload","done","submit","fail","type","id","attributes","installed","wordpress_url","author_id","post_status","categories","getSelect2Values","featured_image","plugin_version","status","setValue","$connection_status","$content_integration","setAttribute","removeAttribute","e","which","$selector","default_value","arguments","length","undefined","value"],"mappings":"6XAAAA,OAAOC,UAAUC,MAAM,WAGrB,GAFmCD,SAASE,cAAc,0BAE3B,CAC7B,IAAIC,EAAa,IAAIC,iBAErBD,EAAWE,aAEXN,OAAO,gCAAgCO,SACrCC,QACAC,iBAAkB,KAClBC,mBAAoB,EACpBC,kBAAmB,qCACnBC,iBAAkB,sCAGpBZ,OAAO,0BAA0BO,SAC/BC,QACAC,iBAAkB,KAClBC,mBAAoB,EACpBC,kBAAmB,qCACnBC,iBAAkB,sCAGCX,SAASE,cAAc,iCAE7BU,iBAAiB,QAAST,EAAWU,OAAOC,KAAKX,IAEhEJ,OAAO,8BAA8BgB,SAASZ,EAAWa,gBAAgBF,KAAKX,IAC9EJ,OAAO,wDAAwDkB,OAAOd,EAAWE,WAAWS,KAAKX,WAI/FC,4BACJ,SAAAA,IAAcc,gBAAAC,KAAAf,GACZe,KAAKC,UAAiBD,KAAKE,SAAS,sCACpCF,KAAKG,MAAiBtB,SAASE,cAAc,0BAC7CiB,KAAKI,eAAiBvB,SAASE,cAAc,uFAGtC,IAAAsB,EAAAL,KACHM,EAAcN,KAAKE,SAAS,gCAC5BK,EAAcP,KAAKE,SAAS,4BAEhCF,KAAKQ,oBAAoB,cAEzB5B,OAAO6B,MACLC,OAAQ,MACRC,IAAKX,KAAKC,UAAY,sBAAwBK,EAAc,WAAaC,EACzEK,aAAa,EACbC,YAAa,mBACbC,SAAU,OACVC,KAAMC,KAAKC,UAAUjB,KAAKkB,qBAE3BC,KAAK,WACJd,EAAKG,oBAAoB,aACzBH,EAAKF,MAAMiB,WAEZC,KAAK,WACJhB,EAAKG,oBAAoB,4DAc3B,OACEO,MACEO,KAAM,6BACNC,GAZkBvB,KAAKE,SAAS,gCAahCsB,YACEC,WAAW,EACXC,cAdgB1B,KAAKE,SAAS,8BAe9ByB,UAdgB3B,KAAKE,SAAS,4BAe9B0B,YAdgB5B,KAAKE,SAAS,iCAe9B2B,WAdgB7B,KAAK8B,iBAAiB,mCAetC1C,KAdgBY,KAAK8B,iBAAiB,6BAetCC,eAdgB/B,KAAKE,SAAS,oCAe9B8B,eAdgBhC,KAAKE,SAAS,mFAoBlB+B,GAClBjC,KAAKkC,SAAS,sCAAuCD,GACrDjC,KAAKd,kDAIL,IAAIiB,EAAuBtB,SAASE,cAAc,0BAC9CqB,EAAuBvB,SAASE,cAAc,iCAC9CoD,EAAuBnC,KAAKE,SAAS,uCACrCkC,EAAuBpC,KAAKE,SAAS,gEAEzCC,EAAMkC,aAAa,+BAAgCF,GACnDhC,EAAMkC,aAAa,4CAAsE,QAAxBD,GAEvC,eAAvBD,EACD/B,EAAeiC,aAAa,WAAY,YAExCjC,EAAekC,gBAAgB,oDAInBC,GACd,GAAc,IAAXA,EAAEC,MAEH,OADAxC,KAAKN,UACE,mCAIF+C,GAA+B,IAApBC,EAAoBC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAJ,GAC9BG,EAAQjE,SAASE,cAAc0D,GAAWK,MAE9C,OAAGA,GAGMJ,2CAIMD,GAA+B,IAApBC,EAAoBC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,MAC1CG,EAAQlE,OAAO6D,GAAWtD,QAAQ,OAEtC,OAAG2D,GAGMJ,mCAIFD,GAAuB,IAAZK,EAAYH,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAJ,GAC1B9D,SAASE,cAAc0D,GAAWK,MAAQA","file":"stackcommerce-wp.min.js","sourcesContent":["jQuery(document).ready(function() {\n  const isStackCommerceConnectPage = document.querySelector('.stackcommerce-wp-form');\n\n  if(isStackCommerceConnectPage) {\n    let sc_connect = new StackCommerce_WP();\n\n    sc_connect.updateForm();\n\n    jQuery('#stackcommerce_wp_categories').select2({\n      tags: [],\n      tokenSeparators: [','],\n      minimumInputLength: 3,\n      containerCssClass: 'stackcommerce-wp-select2-container',\n      dropdownCssClass: 'stackcommerce-wp-select2-dropdown'\n    });\n\n    jQuery('#stackcommerce_wp_tags').select2({\n      tags: [],\n      tokenSeparators: [','],\n      minimumInputLength: 3,\n      containerCssClass: 'stackcommerce-wp-select2-container',\n      dropdownCssClass: 'stackcommerce-wp-select2-dropdown'\n    });\n\n    let $submit_button = document.querySelector('#stackcommerce-wp-form-submit');\n\n    $submit_button.addEventListener('click', sc_connect.notify.bind(sc_connect));\n\n    jQuery('form.stackcommerce-wp-form').keypress(sc_connect.performKeycheck.bind(sc_connect));\n    jQuery('input[name=\"stackcommerce_wp_content_integration[]\"]').change(sc_connect.updateForm.bind(sc_connect));\n  }\n});\n\nclass StackCommerce_WP {\n  constructor() {\n    this.$endpoint      = this.getValue('#stackcommerce_wp_cms_api_endpoint');\n    this.$form          = document.querySelector('#stackcommerce-wp-form');\n    this.$submit_button = document.querySelector('#stackcommerce-wp-form-submit');\n  }\n\n  notify() {\n    let $account_id = this.getValue('#stackcommerce_wp_account_id'),\n        $secret_key = this.getValue('#stackcommerce_wp_secret');\n\n    this.setConnectionStatus('connecting');\n\n    jQuery.ajax({\n      method: 'PUT',\n      url: this.$endpoint + '/api/wordpress/?id=' + $account_id + '&secret=' + $secret_key,\n      processData: false,\n      contentType: 'application/json',\n      dataType: 'json',\n      data: JSON.stringify(this.generatePayload())\n    })\n    .done(() => {\n      this.setConnectionStatus('connected');\n      this.$form.submit();\n    })\n    .fail(() => {\n      this.setConnectionStatus('disconnected');\n    });\n  }\n\n  generatePayload() {\n    let $account_id     = this.getValue('#stackcommerce_wp_account_id'),\n        $wordpress_url  = this.getValue('#stackcommerce_wp_endpoint'),\n        $author_id      = this.getValue('#stackcommerce_wp_author'),\n        $post_status    = this.getValue('#stackcommerce_wp_post_status'),\n        $categories     = this.getSelect2Values('#stackcommerce_wp_categories', []),\n        $tags           = this.getSelect2Values('#stackcommerce_wp_tags', []),\n        $featured_image = this.getValue('#stackcommerce_wp_featured_image'),\n        $plugin_version = this.getValue('#stackcommerce_wp_plugin_version');\n\n    return {\n      data: {\n        type: 'partner_wordpress_settings',\n        id: $account_id,\n        attributes: {\n          installed: true,\n          wordpress_url: $wordpress_url,\n          author_id: $author_id,\n          post_status: $post_status,\n          categories: $categories,\n          tags: $tags,\n          featured_image: $featured_image,\n          plugin_version: $plugin_version\n        }\n      }\n    };\n  }\n\n  setConnectionStatus(status) {\n    this.setValue('#stackcommerce_wp_connection_status', status);\n    this.updateForm();\n  }\n\n  updateForm() {\n    let $form                = document.querySelector('#stackcommerce-wp-form'),\n        $submit_button       = document.querySelector('#stackcommerce-wp-form-submit'),\n        $connection_status   = this.getValue('#stackcommerce_wp_connection_status'),\n        $content_integration = this.getValue('input[name=\"stackcommerce_wp_content_integration[]\"]:checked');\n\n    $form.setAttribute('data-stackcommerce-wp-status', $connection_status);\n    $form.setAttribute('data-stackcommerce-wp-content-integration', ($content_integration == 'true' ? true : false));\n\n    if($connection_status === 'connecting') {\n      $submit_button.setAttribute('disabled', 'disabled');\n    } else {\n      $submit_button.removeAttribute('disabled');\n    }\n  }\n\n  performKeycheck(e) {\n    if(e.which == 13) {\n      this.notify();\n      return false;\n    }\n  }\n\n  getValue($selector, default_value = '') {\n    let value = document.querySelector($selector).value;\n\n    if(value) {\n      return value;\n    } else {\n      return default_value;\n    }\n  }\n\n  getSelect2Values($selector, default_value = []) {\n    let value = jQuery($selector).select2('val');\n\n    if(value) {\n      return value;\n    } else {\n      return default_value;\n    }\n  }\n\n  setValue($selector, value = '') {\n    document.querySelector($selector).value = value;\n  }\n}\n"]}