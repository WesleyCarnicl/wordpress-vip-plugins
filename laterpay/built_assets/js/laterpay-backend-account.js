!function(i){i(function(){function e(){var e={apiKeyInput:i(".lp_js_validateApiKey"),merchantIdInput:i(".lp_js_validateMerchantId"),apiCredentialsInputs:i(".lp_js_validateApiKey, .lp_js_validateMerchantId"),testMerchantId:i("#lp_js_sandboxMerchantId"),testApiKey:i("#lp_js_sandboxApiKey"),liveMerchantId:i("#lp_js_liveMerchantId"),liveApiKey:i("#lp_js_liveApiKey"),pluginModeIndicator:i("#lp_js_pluginModeIndicator"),pluginModeToggle:i("#lp_js_togglePluginMode"),pluginVisibilitySetting:i("#lp_js_pluginVisibilitySetting"),pluginVisibilityToggle:i("#lp_js_toggleVisibilityInTestMode"),hasInvalidSandboxCredentials:i("#lp_js_hasInvalidSandboxCredentials"),isLive:"lp_is-live",navigation:i(".lp_navigation"),region:i("#lp_js_apiRegionSection"),regionNoticeBlock:i("#lp_js_regionNotice"),showMerchantContractsButton:i("#lp_js_showMerchantContracts"),apiCredentials:i("#lp_js_apiCredentialsSection"),requestSent:!1,pluginDelete:i(".lp_js_disablePlugin"),pluginDeleteConfirm:i(".lp_js_disablePluginConfirm"),modalClose:i("button.lp_js_ga_cancel")},n=e.region.val(),t=function(){e.apiKeyInput.bind("input",function(){var i=this;setTimeout(function(){p(i)},50)}),e.merchantIdInput.bind("input",function(){var i=this;setTimeout(function(){u(i)},50)}),e.region.change(function(){c()}),e.pluginModeToggle.change(function(){r()}),e.pluginVisibilityToggle.change(function(){o()}),e.showMerchantContractsButton.bind("click",function(){return i(this).attr("href",i(this).data("href-"+e.region.val())),!0}),window.onbeforeunload=function(){v()},e.pluginDelete.on("click",function(){"function"==typeof tb_show&&(tb_show(lpVars.modal.title,"#TB_inline?inlineId="+lpVars.modal.id+"&height=185&width=375"),i("div#TB_ajaxContent").css("padding","30px"))}),e.pluginDeleteConfirm.click(function(){i("#TB_closeWindowButton").click(),a()}),e.modalClose.click(function(){i("#TB_closeWindowButton").click()})},a=function(){var n={action:"laterpay_disable_plugin",security:lpVars.plugin_disable_nonce};i.post(ajaxurl,n,function(n){"string"===i.type(n)&&(n=JSON.parse(n)),e.navigation.showMessage(n),!1===n.is_vip?setTimeout(function(){window.location.replace(lpVars.pluginsUrl)},2e3):setTimeout(function(){window.location.reload()},2e3)})},l=function(){for(var i=0,n=e.apiCredentialsInputs.length;i<n;i++)if(""===e.apiCredentialsInputs.eq(i).val())return void e.apiCredentialsInputs.eq(i).focus()},o=function(){g()?(e.hasInvalidSandboxCredentials.val(1),e.pluginVisibilityToggle.prop("checked",!1),e.testMerchantId.focus(),e.showMerchantContractsButton.velocity("fadeIn",{duration:250}),e.requestSent=!1):e.hasInvalidSandboxCredentials.val(0),d("laterpay_test_mode")},s=function(n){"live"===n?(i("#lp_js_pluginModeIndicator").velocity("fadeOut",{duration:250}),i("#lp_js_liveCredentials").addClass(e.isLive)):(i("#lp_js_pluginModeIndicator").velocity("fadeIn",{duration:250}),i("#lp_js_liveCredentials").removeClass(e.isLive))},r=function(){var i=e.pluginModeToggle,n=i.prop("checked");g()?(i.prop("checked",!1),e.liveMerchantId.focus(),e.requestSent=!1,e.pluginVisibilitySetting.velocity("fadeIn",{duration:250,display:"inline-block"})):n?(e.pluginVisibilitySetting.velocity("fadeOut",{duration:250}),e.showMerchantContractsButton.velocity("fadeOut",{duration:250})):e.pluginVisibilitySetting.velocity("fadeIn",{duration:250,display:"inline-block"}),d("laterpay_plugin_mode")},c=function(){var t="laterpay_region";i.post(ajaxurl,i("#"+t).serializeArray(),function(i){e.navigation.showMessage(i),i.success?(n=e.region.val(),e.testMerchantId.val(i.creds.cp_key),e.testApiKey.val(i.creds.api_key),"us"!==n?e.regionNoticeBlock.removeClass("hidden"):e.regionNoticeBlock.addClass("hidden")):e.region.val(n)},"json")},d=function(n){e.requestSent||(e.requestSent=!0,i.post(ajaxurl,i("#"+n).serializeArray(),function(i){e.navigation.showMessage(i),s(i.mode)},"json").done(function(){if(e.requestSent=!1,"laterpay_plugin_mode"===n){var t=e.pluginModeToggle.prop("checked")?"Live":"Test",a=i("#lp_js_sandboxMerchantId").val(),l=i("#lp_js_liveMerchantId").val(),o=a+" | "+l+" | "+lpVars.gaData.site_url+" | ",s="LP WP Account",r="Account Status Change";lpGlobal.sendLPGAEvent(r,s,o+t)}}))},p=function(n){var t=i(n),a=t.parents("form"),l=t.val().trim(),s=32;if(l.length!==t.val().length&&t.val(l),0===l.length||l.length===s)d(a.attr("id"));else{e.navigation.showMessage(lpVars.i18nApiKeyInvalid,!1);var c=e.testApiKey.parents("form").attr("id");a.attr("id")===c&&o()}g()&&r()},u=function(n){var t=i(n),a=t.parents("form"),l=t.val().trim(),s=22;if(l.length!==t.val().length&&t.val(l),0===l.length||l.length===s)d(a.attr("id"));else{e.navigation.showMessage(lpVars.i18nMerchantIdInvalid,!1);var c=e.testMerchantId.parents("form").attr("id");a.attr("id")===c&&o()}g()&&r()},g=function(){var i=32!==e.liveApiKey.val().length||22!==e.liveMerchantId.val().length;return e.pluginModeToggle.prop("checked")&&i},v=function(){if(g())return lpVars.i18nPreventUnload},_=function(){t(),l()};_()}e()})}(jQuery);