!function(e){e(function(){function i(){var i={body:e("body"),previewModePlaceholder:e("#lp_js_previewModePlaceholder"),previewModeContainer:"#lp_js_previewModeContainer",previewModeForm:"#lp_js_previewModeForm",previewModeToggle:"#lp_js_togglePreviewMode",previewModeInput:"#lp_js_previewModeInput",previewModeVisibilityForm:"#lp_js_previewModeVisibilityForm",previewModeVisibilityToggle:"#lp_js_togglePreviewModeVisibility",previewModeVisibilityInput:"#lp_js_previewModeVisibilityInput",optionContainer:".lp_purchase-overlay-option",optionInput:".lp_purchase-overlay-option__input",submitButtonText:".lp_purchase-overlay__submit-text",timePass:".lp_js_timePass",flipTimePassLink:".lp_js_flipTimePass",timePassPreviewPrice:".lp_js_timePassPreviewPrice",voucherCodeWrapper:"#lp_js_voucherCodeWrapper",voucherCodeInput:".lp_js_voucherCodeInput",voucherRedeemButton:".lp_js_voucherRedeemButton",giftCardRedeemButton:".lp_js_giftCardRedeemButton",giftCardCodeInput:".lp_js_giftCardCodeInput",giftCardWrapper:"#lp_js_giftCardWrapper",giftCardActionsPlaceholder:".lp_js_giftCardActionsPlaceholder",giftsWrapper:e(".lp_js_giftsWrapper"),subscription:".lp_js_subscription",flipSubscriptionLink:".lp_js_flipSubscription",postContentPlaceholder:e("#lp_js_postContentPlaceholder"),purchaseLink:".lp_js_doPurchase",purchaseOverlay:".lp_js_overlayPurchase",currentOverlay:'input[name="lp_purchase-overlay-option"]:checked',hidden:"lp_is-hidden",fadingOut:"lp_is-fading-out",premiumBox:".lp_js_premium-file-box",redeemVoucherBlock:e(".lp_purchase-overlay__voucher"),notificationButtons:e(".lp_js_notificationButtons"),notificationCancel:e(".lp_js_notificationCancel"),voucherCancel:".lp_js_voucherCancel",redeemVoucherButton:".lp_js_redeemVoucher",overlayMessageContainer:".lp_js_purchaseOverlayMessageContainer",overlayTimePassPrice:".lp_js_timePassPrice"},t=function(i){var t=e("<div/>",{id:"lp_js_voucherCodeFeedbackMessage","class":"lp_voucher__feedback-message",style:"display:none;"}).text(i);return t},o=function(i){var t=e("<div/>",{id:"lp_js_voucherCodeFeedbackMessage","class":"lp_purchase-overlay__voucher-error"}).text(i);return t},a=function(){i.previewModeContainer=e("#lp_js_previewModeContainer"),i.previewModeForm=e("#lp_js_previewModeForm"),i.previewModeToggle=e("#lp_js_togglePreviewMode"),i.previewModeInput=e("#lp_js_previewModeInput"),i.previewModeVisibilityForm=e("#lp_js_previewModeVisibilityForm"),i.previewModeVisibilityToggle=e("#lp_js_togglePreviewModeVisibility"),i.previewModeVisibilityInput=e("#lp_js_previewModeVisibilityInput")},n=function(){i.previewModeToggle.on("change",function(){h()}),i.previewModeVisibilityToggle.on("mousedown",function(){f()}).on("click",function(e){e.preventDefault()})},r=function(){i.body.on("mousedown",i.purchaseLink,function(){m(this)}).on("click",i.purchaseLink,function(i){i.preventDefault(),e(this).data("preview-post-as-visitor")?alert(lpVars.i18n.alert):window.location.href=e(this).data("laterpay")}),i.body.on("mousedown",i.purchaseOverlay,function(){m(this)}).on("click",i.purchaseOverlay,function(i){i.preventDefault(),e(this).data("preview-post-as-visitor")?alert(lpVars.i18n.alert):s(e(this).attr("data-purchase-action"))}),i.body.on("click",i.optionContainer,function(t){switch(t.preventDefault(),e(this).find(i.optionInput).attr("checked","checked"),e(this).data("revenue")){case"sis":e(i.submitButtonText).text(lpVars.i18n.revenue.sis);break;case"sub":e(i.submitButtonText).text(lpVars.i18n.revenue.sub);break;case"ppu":default:e(i.submitButtonText).text(lpVars.i18n.revenue.ppu)}}),i.body.on("click",i.redeemVoucherButton,function(t){t.preventDefault(),i.redeemVoucherBlock.removeClass("lp_hidden"),i.notificationButtons.addClass("lp_hidden"),i.notificationCancel.removeClass("lp_hidden"),e(i.purchaseOverlay).find('[data-buy-label="true"]').addClass("lp_hidden"),e(i.purchaseOverlay).find('[data-voucher-label="true"]').removeClass("lp_hidden"),e(i.purchaseOverlay).attr("data-purchase-action","voucher")}),i.body.on("click",i.voucherCancel,function(t){t.preventDefault(),i.redeemVoucherBlock.addClass("lp_hidden"),i.notificationButtons.removeClass("lp_hidden"),i.notificationCancel.addClass("lp_hidden"),e(i.purchaseOverlay).find('[data-buy-label="true"]').removeClass("lp_hidden"),e(i.purchaseOverlay).find('[data-voucher-label="true"]').addClass("lp_hidden"),e(i.purchaseOverlay).attr("data-purchase-action","buy")}),i.body.on("click",i.flipTimePassLink,function(e){e.preventDefault(),y(this)}),i.body.on("click",i.flipSubscriptionLink,function(e){e.preventDefault(),y(this)})},s=function(t){return"buy"===t&&(window.location.href=e(i.currentOverlay).val()),"voucher"===t&&(e(i.overlayMessageContainer).html(""),p(e(i.overlayMessageContainer),o,i.voucherCodeInput,"purchase-overlay",!1)),!1},l=function(){e(i.voucherRedeemButton).on("mousedown",function(){p(e(this).parent(),t,i.voucherCodeInput,"time-pass",!1)}).on("click",function(e){e.preventDefault()}),e(i.giftCardRedeemButton).on("mousedown",function(){p(e(this).parent(),t,i.giftCardCodeInput,"time-pass",!0)}).on("click",function(e){e.preventDefault()})},p=function(t,o,a,n,r){var s=e(a).val();6===s.length?e.get(lpVars.ajaxUrl,{action:"laterpay_redeem_voucher_code",code:s,link:window.location.href},function(l){if(e(a).val(""),l.success)if(r)e("#fakebtn").attr("data-laterpay",l.url).click();else{var p,c,u=!1;"time_pass"===l.type&&e(i.timePass).each(function(){if(p=e(this).data("pass-id"),p===l.pass_id)return u=!0,!1}),"subscription"===l.type&&e(i.subscription).each(function(){if(c=e(this).data("sub-id"),c===l.sub_id)return u=!0,!1}),u?window.location.href=l.url:d(s+lpVars.i18n.invalidVoucher,o,n,t)}else d(s+lpVars.i18n.invalidVoucher,o,n,t)},"json"):d(lpVars.i18n.codeTooShort,o,n,t)},d=function(i,t,o,a){var n=t(i);"purchase-overlay"===o&&a.empty().append(n),"time-pass"===o&&(a.prepend(n),n=e("#lp_js_voucherCodeFeedbackMessage",a),n.fadeIn(250).click(function(){c(n)}),setTimeout(function(){c(n)},3e3))},c=function(e){e.fadeOut(250,function(){e.unbind().remove()})},u=function(){var t=[],o=i.giftsWrapper;e.each(o,function(i){t.push(e(o[i]).data("id"))}),e.get(lpVars.ajaxUrl,{action:"laterpay_get_gift_card_actions",pass_id:t,link:window.location.href},function(t){t.data&&(e.each(t.data,function(o){var a=t.data[o],n=e(i.giftCardActionsPlaceholder+"_"+a.id);n.empty().append(a.html),a.buy_more&&e(a.buy_more).appendTo(n.parent()).attr("href",window.location.href)}),g("laterpay_purchased_gift_card"))},"json")},v=function(){var t=[],o=[],a=e(i.premiumBox);e.each(a,function(i){t.push(e(a[i]).data("post-id")),o.push(e(a[i]).data("content-type"))}),e.get(lpVars.ajaxUrl,{action:"laterpay_get_premium_shortcode_link",ids:t,types:o,post_id:lpVars.post_id},function(i){if(i.data){var t=null;e.each(i.data,function(o){t=i.data[o],e.each(a,function(i){e(a[i]).data("post-id").toString()===o&&e(a[i]).prepend(t)})})}w()},"json")},_=function(){e.ajax({url:lpVars.ajaxUrl,method:"GET",data:{action:"laterpay_preview_mode_render",post_id:lpVars.post_id},xhrFields:{withCredentials:!0}}).done(function(e){e&&(i.previewModePlaceholder.before(e).remove(),a(),n())})},h=function(){i.previewModeToggle.prop("checked")?i.previewModeInput.val(1):i.previewModeInput.val(0),e.ajax({url:lpVars.ajaxUrl,method:"POST",data:i.previewModeForm.serializeArray(),xhrFields:{withCredentials:!0}}).done(function(){window.location.reload()})},f=function(){var t=i.previewModeContainer.hasClass(i.hidden)?"0":"1";i.previewModeVisibilityInput.val(t),i.previewModeContainer.toggleClass(i.hidden),e.ajax({url:lpVars.ajaxUrl,method:"POST",data:i.previewModeVisibilityForm.serializeArray(),xhrFields:{withCredentials:!0}})},m=function(i){e(i).data("preview-as-visitor")&&!e(i).data("is-in-visible-test-mode")&&alert(lpVars.i18n.alert)},w=function(){var e=b("laterpay_download_attached");e&&(g("laterpay_download_attached"),window.location.href=e)},y=function(i){e(i).parents(".lp_time-pass").toggleClass("lp_is-flipped")},g=function(e){document.cookie=e+"=; expires=Thu, 01-Jan-70 00:00:01 GMT; path=/"},b=function(e){var i=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return i?decodeURIComponent(i[1]):void 0},C=function(){1===i.previewModePlaceholder.length&&_(),i.giftsWrapper.length>=1&&u(),e(i.premiumBox).length>=1&&v(),r(),l()};C()}i()})}(jQuery);